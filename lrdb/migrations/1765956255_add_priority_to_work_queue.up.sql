-- 1765956255_add_priority_to_work_queue.up.sql

-- Code generated by database migration. DO NOT EDIT.

-- Add priority field to work_queue table.
-- Lower values = higher priority (negative values are highest priority).
-- Default is 0 for normal operations.

ALTER TABLE work_queue
  ADD COLUMN priority INTEGER NOT NULL DEFAULT 0;

-- Drop and recreate the claim index to include priority for ordering.
-- Workers will claim lower priority values first.
DROP INDEX IF EXISTS idx_work_queue_claim;

CREATE INDEX idx_work_queue_claim
  ON work_queue (task_name, priority, id)
  WHERE claimed_by = -1 AND failed = false;
