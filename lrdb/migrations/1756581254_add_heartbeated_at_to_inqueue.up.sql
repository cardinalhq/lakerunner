-- 1756581254_add_heartbeated_at_to_inqueue.up.sql

-- Code generated by database migration. DO NOT EDIT.

-- NOTE: This migration previously modified the inqueue table which has since been dropped

-- Add heartbeated_at field to inqueue table for heartbeat mechanism
-- ALTER TABLE inqueue ADD COLUMN IF NOT EXISTS heartbeated_at TIMESTAMPTZ;

-- Create index for efficient cleanup queries on heartbeated_at
-- Only index non-null heartbeated_at values (claimed items)
-- CREATE INDEX IF NOT EXISTS idx_inqueue_heartbeated_at_nonnull
-- ON inqueue (heartbeated_at)
-- WHERE heartbeated_at IS NOT NULL;

-- Create index for efficient expired heartbeat cleanup
-- Find items that have been claimed but haven't heartbeated recently
-- CREATE INDEX IF NOT EXISTS idx_inqueue_expired_heartbeat
-- ON inqueue (heartbeated_at, claimed_by)
-- WHERE claimed_by <> -1 AND heartbeated_at IS NOT NULL;