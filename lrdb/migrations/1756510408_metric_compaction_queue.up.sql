-- 1756510408_metric_compaction_queue.up.sql

-- Code generated by database migration. DO NOT EDIT.


-- ===== Record-count estimates (per org+frequency, global via zero-UUID) =====
CREATE TABLE IF NOT EXISTS metric_pack_estimate (
  organization_id UUID    NOT NULL,  -- use 00000000-0000-0000-0000-000000000000 for global
  frequency_ms    BIGINT  NOT NULL,
  target_records  BIGINT,
  updated_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
  PRIMARY KEY (organization_id, frequency_ms)
);

-- Optional helper indexes
CREATE INDEX IF NOT EXISTS idx_mpe_freq_global
  ON metric_pack_estimate (frequency_ms)
  WHERE organization_id = '00000000-0000-0000-0000-000000000000'::uuid;

INSERT INTO metric_pack_estimate (organization_id, frequency_ms, target_records)
VALUES ('00000000-0000-0000-0000-000000000000',   10000, 40000),
       ('00000000-0000-0000-0000-000000000000',   60000, 40000),
       ('00000000-0000-0000-0000-000000000000',  300000, 40000),
       ('00000000-0000-0000-0000-000000000000', 1200000, 40000),
       ('00000000-0000-0000-0000-000000000000', 3600000, 40000)
ON CONFLICT (organization_id, frequency_ms) DO UPDATE
SET target_records = EXCLUDED.target_records,
    updated_at     = now();
