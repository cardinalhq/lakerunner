-- 1757509449_add_signal_to_pack_estimator.down.sql

-- Code generated by database migration. DO NOT EDIT.

-- Revert signal column addition and table rename

-- Step 1: Rename table back to metric_pack_estimate
ALTER INDEX idx_pe_freq_signal_global RENAME TO idx_mpe_freq_signal_global;
ALTER TABLE pack_estimate RENAME TO metric_pack_estimate;

-- Step 2: Delete logs and traces records
DELETE FROM metric_pack_estimate WHERE signal IN ('logs', 'traces');

-- Step 3: Drop the new index
DROP INDEX IF EXISTS idx_mpe_freq_signal_global;

-- Step 4: Drop the new primary key
ALTER TABLE metric_pack_estimate 
DROP CONSTRAINT metric_pack_estimate_pkey;

-- Step 5: Drop the signal column
ALTER TABLE metric_pack_estimate 
DROP COLUMN signal;

-- Step 6: Recreate the original primary key
ALTER TABLE metric_pack_estimate 
ADD PRIMARY KEY (organization_id, frequency_ms);

-- Step 7: Recreate the original index
CREATE INDEX IF NOT EXISTS idx_mpe_freq_global
  ON metric_pack_estimate (frequency_ms)
  WHERE organization_id = '00000000-0000-0000-0000-000000000000'::uuid;