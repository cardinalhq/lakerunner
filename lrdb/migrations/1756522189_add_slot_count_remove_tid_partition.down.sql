-- 1756522189_add_slot_count_remove_tid_partition.down.sql

-- Code generated by database migration. DO NOT EDIT.

-- Drop the slot constraints
ALTER TABLE metric_seg 
    DROP CONSTRAINT IF EXISTS metric_seg_slot_count_positive;

ALTER TABLE metric_seg 
    DROP CONSTRAINT IF EXISTS metric_seg_slot_id_range;

-- Add back the tid_count column with default value  
ALTER TABLE metric_seg 
    ADD COLUMN tid_count INTEGER NOT NULL DEFAULT 0;

-- Add back the tid_partition column with default value
ALTER TABLE metric_seg 
    ADD COLUMN tid_partition SMALLINT NOT NULL DEFAULT 0;

-- Drop the current primary key
ALTER TABLE metric_seg 
    DROP CONSTRAINT metric_seg_pkey;

-- Recreate the original primary key that includes tid_partition
ALTER TABLE metric_seg 
    ADD CONSTRAINT metric_seg_pkey 
    PRIMARY KEY (organization_id, dateint, frequency_ms, segment_id, instance_num, tid_partition);

-- Remove the slot_count column
ALTER TABLE metric_seg 
    DROP COLUMN slot_count;

-- Remove the compacted column
ALTER TABLE metric_seg 
    DROP COLUMN compacted;

