-- 1756583228_add_heartbeated_at_to_mcq.up.sql

-- Code generated by database migration. DO NOT EDIT.

-- NOTE: Removed operations on metric_compaction_queue since table is later dropped

-- Add heartbeated_at field to metric_compaction_queue table for heartbeat mechanism
-- ALTER TABLE metric_compaction_queue ADD COLUMN IF NOT EXISTS heartbeated_at TIMESTAMPTZ;

-- Create index for efficient cleanup queries on heartbeated_at
-- Only index non-null heartbeated_at values (claimed items)
-- CREATE INDEX IF NOT EXISTS idx_mcq_heartbeated_at_nonnull
-- ON metric_compaction_queue (heartbeated_at)
-- WHERE heartbeated_at IS NOT NULL;

-- Create index for efficient expired heartbeat cleanup
-- Find items that have been claimed but haven't heartbeated recently
-- CREATE INDEX IF NOT EXISTS idx_mcq_expired_heartbeat
-- ON metric_compaction_queue (heartbeated_at, claimed_by)
-- WHERE claimed_by <> -1 AND heartbeated_at IS NOT NULL;