-- 1755713265_remove_lrconfig_prefix.up.sql

-- Code generated by database migration. DO NOT EDIT.

-- Remove lrconfig_ prefix from all table names for cleaner schema

-- Rename bucket management tables
ALTER TABLE lrconfig_bucket_configurations RENAME TO bucket_configurations;
ALTER TABLE lrconfig_organization_buckets RENAME TO organization_buckets;
ALTER TABLE lrconfig_bucket_prefix_mappings RENAME TO bucket_prefix_mappings;

-- Rename API key tables
ALTER TABLE lrconfig_admin_api_keys RENAME TO admin_api_keys;
ALTER TABLE lrconfig_organization_api_keys RENAME TO organization_api_keys;
ALTER TABLE lrconfig_organization_api_key_mappings RENAME TO organization_api_key_mappings;

-- Rename organizations table
ALTER TABLE lrconfig_organizations RENAME TO organizations;

-- Rename indexes to match new table names
-- Bucket configuration indexes
DROP INDEX IF EXISTS idx_bucket_configs_name;
CREATE INDEX idx_bucket_configs_name ON bucket_configurations(bucket_name);

-- Organization buckets indexes
DROP INDEX IF EXISTS idx_org_buckets_org;
DROP INDEX IF EXISTS idx_org_buckets_bucket;
CREATE INDEX idx_org_buckets_org ON organization_buckets(organization_id);
CREATE INDEX idx_org_buckets_bucket ON organization_buckets(bucket_id);

-- Bucket prefix mappings indexes
DROP INDEX IF EXISTS idx_prefix_bucket_prefix_signal;
DROP INDEX IF EXISTS idx_prefix_org;
CREATE INDEX idx_prefix_bucket_prefix_signal ON bucket_prefix_mappings(bucket_id, signal, path_prefix text_pattern_ops);
CREATE INDEX idx_prefix_org ON bucket_prefix_mappings(organization_id);

-- Admin API keys indexes
DROP INDEX IF EXISTS idx_admin_api_keys_hash;
CREATE INDEX idx_admin_api_keys_hash ON admin_api_keys(key_hash);

-- Organization API keys indexes
DROP INDEX IF EXISTS idx_org_api_keys_hash;
CREATE INDEX idx_org_api_keys_hash ON organization_api_keys(key_hash);

-- Organization API key mappings indexes
DROP INDEX IF EXISTS idx_org_api_key_mappings_key;
DROP INDEX IF EXISTS idx_org_api_key_mappings_org;
CREATE INDEX idx_org_api_key_mappings_key ON organization_api_key_mappings(api_key_id);
CREATE INDEX idx_org_api_key_mappings_org ON organization_api_key_mappings(organization_id);

-- Organizations indexes
DROP INDEX IF EXISTS idx_lrconfig_organizations_name;
DROP INDEX IF EXISTS idx_lrconfig_organizations_enabled;
CREATE INDEX idx_organizations_name ON organizations(name);
CREATE INDEX idx_organizations_enabled ON organizations(enabled);